---
title: "Respirometry data analysis (AMMONIUM) C. Fleming Last updated: 2/24/23"
output:
  pdf_document: default
  html_notebook: default
authors: Caroline Fleming

#Some resources:
  #https://rstudio-pubs-static.s3.amazonaws.com/63556_e35cc7e2dfb54a5bb551f3fa4b3ec4ae.html

#### ammonium ### New & improved! With updated ammonium only controls
---

```{r Install required packages}
require("knitr")

#install.packages("lmerTest")
library("lmerTest")
#install.packages("Matrix")
library("Matrix")
#install.packages("lme4")
library("lme4")
#install.packages("emmeans")
library("emmeans")
#install.packages("pbkrtest")
library("pbkrtest")
library("tidyverse")
library("performance")
#install.packages("see")
library("see")
#install.packages("ggrepel")
library("ggrepel")
#install.packages("sjPlot") #for visualizing linear models
library(sjPlot)
#install.packages("MASS")
library(MASS)
#install.packages("glmmTMB") # for visualizing model checks
library(glmmTMB)
#install.packages("relaimpo") #for quantifying the effects of predictor variables
library(relaimpo)
#install.packages("outliers") #for checking out whether a data point is an outlier
library(outliers)
library(Rmisc)
#install.packages("ggeffects")
library(ggeffects)

#turn off scientific notation
options(scipen=999)

#let dplyr print a bunch of numbers
options(dplyr.print_max = 1e9)
options(max.print = 10000)   

```


```{r Set working directory and upload data - ammonium DATA ONLY}
#opts_knit$set(root.dir = "C:/Users/carol/Documents/PhD Boston University 2019-/Chapter_2_Ecotox/Summer_2022_N_Ecotox/N_Ecotox_Chapter_2_ANALYSIS/Astrangia_nutrient_stressors_Rotjan_lab")
#getwd()

# We made a separate ammonium excel file now so we're all set to upload & go
resp_all_ammonium.data <- read.csv("RESP_Ammonium_Cleaned_G30Y76_exp2A_outlier_deleted.csv", header=TRUE, sep=",",stringsAsFactors = FALSE)
resp_all_ammonium.data<-na.omit(resp_all_ammonium.data)
hist(resp_all_ammonium.data$resp_rate) #slight skew but we're okay let's keep using it
qqnorm(resp_all_ammonium.data$resp_rate) #this looks really nice

#make sure treatID is a character
resp_all_ammonium.data$treat_ID_full<-as.character(resp_all_ammonium.data$treat_ID_full)
resp_all_ammonium.data$e_coli_plate<-as.character(resp_all_ammonium.data$e_coli_plate)
resp_all_ammonium.data$temp <- as.character(resp_all_ammonium.data$temp)

# #adding a log transformed resp rate
resp_all_ammonium.data$log_resp_rate<-abs(resp_all_ammonium.data$resp_rate)
resp_all_ammonium.data$log_resp_rate<-log(resp_all_ammonium.data$log_resp_rate)
hist(resp_all_ammonium.data$log_resp_rate)
#this looks a lot better


# #testing for normality
# #TESTING FOR NORMALITY IN PAM_delta
# #install new package to see what the best transformation is
# #install.packages("bestNormalize")
# library("bestNormalize")
# bestNormalize(resp_all_ammonium.data$resp_rate)
# #in order for this to work I need to change the PAM_delta in to a vector
# resp_all_ammonium.data$resp_rate_vector<-as.vector(resp_all_ammonium.data$resp_rate_vector)
# #then I run the orderNorm command into a new object
# orderNormobj_resp_rate<-orderNorm(resp_all_ammonium.data$resp_rate)
# #this object gives us what we want, but we have to index from that object and put it in a new column
# resp_all_ammonium.data$ordernorm_resp_rate<-orderNormobj_resp_rate$x.t
# 
# Essential subsets
all_20C<-subset(resp_all_ammonium.data, resp_all_ammonium.data$temp==20)
all_30C<-subset(resp_all_ammonium.data, resp_all_ammonium.data$temp==30)
all_apo<-subset(resp_all_ammonium.data, resp_all_ammonium.data$sym_state=="A")
all_sym<-subset(resp_all_ammonium.data, resp_all_ammonium.data$sym_state=="S")
e_coli<-subset(resp_all_ammonium.data, resp_all_ammonium.data$e_coli_plate=="1")
no_e_coli<-subset(resp_all_ammonium.data, resp_all_ammonium.data$e_coli_plate=="0")
```


#Linear models

```{r linear models - ALL ammonium DATA}
mm_resp_null <- lmer(resp_rate ~ 1 + (1|vial_ID) + (1|col_num) + (1|exp_num) +(1|exp_subrun) +(1|jar_unique_ID) + (1|resp_run) , data= resp_all_ammonium.data)
summary(mm_resp_null)
#that null looks good, intercept is significant

#full model with all interactions possible
mm_resp_1 <- lmer(resp_rate ~  N_species_dose + temp + food + sym_state + e_coli_plate + N_species_dose*temp + N_species_dose*food + N_species_dose*sym_state + N_species_dose*e_coli_plate + temp*food + temp*sym_state + temp*e_coli_plate + food*sym_state + food*e_coli_plate + sym_state*e_coli_plate + (1|vial_ID) +  (1|col_num) + (1|exp_num) + (1|exp_subrun), data= resp_all_ammonium.data)
summary(mm_resp_1)


# OKAY NOW LETS TRY TO DO A STEPWISE LINEAR REGRESSION A LA RANDI's SUGGESTION
# This stepwise function includes random effects, but does not like random effects that cause singularity so I had to get rid of a bunch of them
full.model <- lmer(resp_rate ~  N_species_dose + temp + food + sym_state + e_coli_plate + N_species_dose*temp + N_species_dose*food + N_species_dose*sym_state + N_species_dose*e_coli_plate + temp*food + temp*sym_state + temp*e_coli_plate + food*sym_state + food*e_coli_plate + sym_state*e_coli_plate +  + (1|vial_ID) +  (1|col_num) + (1|exp_num) + (1|exp_subrun), data= resp_all_ammonium.data)
print(step.model<- step(full.model))


# here is the model that it recommends
mm_resp_2 <- lmer(resp_rate ~ N_species_dose + e_coli_plate + sym_state + (1 | col_num) + (1|vial_ID), data=resp_all_ammonium.data)
summary(mm_resp_2)


# lets add temp for fun and see what happens
mm_resp_3 <- lmer(resp_rate ~ N_species_dose + e_coli_plate + sym_state + temp + (1|vial_ID) + (1 | col_num), data=resp_all_ammonium.data)
summary(mm_resp_3) 


AIC(mm_resp_2, mm_resp_3) # mm_resp_2 wins AIC, but only by 14 so I feel pretty good about keeping temp in there

mm_resp_2 <- lmer(resp_rate ~ N_species_dose + e_coli_plate + sym_state + temp + (1|vial_ID) + (1 | col_num), data=resp_all_ammonium.data)
summary(mm_resp_2)
# WINNER # WINNER # WINNER

#  CHECKING MODEL FITNESS AND VISUALIZING MODEL for our winning model mm_resp_2
#checking for model fit
plot(mm_resp_2) #homogeneity of variance,looks okay--they are relatively distributed around 0
r2(mm_resp_2) #marginal id variance just by fixed factors, conditional includes variance explained by random factor
  # treatment explains 7.2% of variation
  # Random effects 22.4% genetic effect (conditional)
# !!!!!!!!!!!!! WEE WOO LOOK INTO THIS !!!!!!!!!!!!!!!!!!
check_collinearity(mm_resp_2) # Low correlation
check_outliers(mm_resp_2) #it looks like there might be an outlier so let's look into this #we fixed it, no outlier!
grubbs.test(resp_all_ammonium.data$resp_rate) # Yes! There is an outlier, it's value is -0.01564, its beetag is G30Y76_exp2A #we fixed this

check_heteroscedasticity(mm_resp_2) #heteroscadasticity detected
check_homogeneity(mm_resp_2) #variances different between groups
check_autocorrelation(mm_resp_2) #all good, there is independence
#Now this command will plot all of our model diagnostics to visualize them
plot_model(mm_resp_2, type="diag") #everything looks pretty good


#checking out the contribution of each variable to the mode
summary(mm_resp_2)$coef
#we can just interpret t as an index of how important the effect is without trying to use some p-value to describe it

#looking at just the random effect part of the model
VarCorr(mm_resp_2) #not really sure how to interpret this

plot_model(mm_resp_2, "eff") # plots the predicted effects of each variable on respiration rate 
plot_model(mm_resp_2, type="re") # plots random effects

plot_model(mm_resp_2)
tab_model(mm_resp_2, digits=7) #adding digits tells it to include more decimal places

#let's try using the package relaimpo to give us a sense of the relative contribution of each variable to the model
# link for info on this package: https://advstats.psychstat.org/book/mregression/importance.php
library(relaimpo)
lm_resp_2_relimp <- lm(resp_rate ~ factor(N_species_dose) + factor(sym_state) + factor(temp) + 
    factor(e_coli_plate), data = resp_all_ammonium.data) #for some reason this code would not run unless I treated them as factors
calc.relimp(lm_resp_2_relimp, type="lmg", rela=TRUE)
#need to identify exactly what lmg means
```


```{r Posthocs and Pairwise Comparisons}

# Reminder: this is our model
mm_resp_2 <- lmer(resp_rate ~ N_species_dose + e_coli_plate + sym_state + temp + (1|vial_ID) + (1 | col_num), data=resp_all_ammonium.data)
summary(mm_resp_2)

    # Question: is there a dose of ammonium where we see a statistically significant effect on respiration?
#Pairwise for N_species_dose
emm_resp_2_N_species_dose=emmeans(mm_resp_2, specs=pairwise ~ N_species_dose)
summary(emm_resp_2_N_species_dose)
 # contrast         estimate       SE    df t.ratio p.value
 # A_10 - A_5      -0.000140 0.000305  63.8  -0.460  0.9674
 # A_10 - A_7.5    -0.000829 0.000283 110.6  -2.926  0.0214
 # A_10 - CNTRL_0  -0.000595 0.000287 101.0  -2.071  0.1695
 # A_5 - A_7.5     -0.000688 0.000285 131.3  -2.417  0.0788
 # A_5 - CNTRL_0   -0.000454 0.000290 107.9  -1.568  0.4013
 # A_7.5 - CNTRL_0  0.000234 0.000297  62.4   0.787  0.8601

# we should plot this to get a better idea

    # Question: do corals that experienced heat stress have statistically significant different respiration?
#pairwise for temp
emm_resp_2_temp=emmeans(mm_resp_2, specs=pairwise ~ temp)
summary(emm_resp_2_temp)
 # contrast         estimate       SE  df t.ratio p.value
 # temp20 - temp30 -0.000345 0.000192 325  -1.792  0.0740
    # Answer: Yes! Corals at 30C respired MARGINALLY less than those at 20C.
mean(all_20C$resp_rate, na.rm=TRUE)
#-0.004543656 #respired more than 30C
mean(all_30C$resp_rate, na.rm=TRUE)
#-0.004188804

# Question: do sym versus apo have statistically significant different respiration? 
emm_resp_2_sym_state=emmeans(mm_resp_2, specs=pairwise ~ sym_state)
summary(emm_resp_2_sym_state)
 # contrast estimate       SE  df t.ratio p.value
 # A - S    0.000506 0.000227 195   2.230  0.0269
mean(all_apo$resp_rate, na.rm=TRUE)
#-0.004124044 
mean(all_sym$resp_rate, na.rm=TRUE)
#-0.004605134 #respired more than apo

#sym corals respired more than apo


# Question: do E. coli versus no e coli have statistically significant different respiration?
#pairwise for e coli
emm_resp_2_e_coli=emmeans(mm_resp_2, specs=pairwise ~ e_coli_plate)
summary(emm_resp_2_e_coli)
 # contrast                      estimate       SE  df t.ratio p.value
 # e_coli_plate0 - e_coli_plate1 0.000485 0.000205 318   2.366  0.0186
  #Answer: E. coli plates respired more than plates without e coli.
mean(e_coli$resp_rate, na.rm=TRUE)
# -0.004647869 #respired more than no_e_coli
mean(no_e_coli$resp_rate, na.rm=TRUE)
# -0.004092513


#Question: what is the relationship between N dose and E. coli?
emm_resp_2_N_dose_e_coli=emmeans(mm_resp_2, specs=pairwise ~ N_species_dose*e_coli_plate)
summary(emm_resp_2_N_dose_e_coli)
#here are the significant and marginally significant contrasts:
#  contrast                                         estimate       SE  df t.ratio p.value
#  A_10 e_coli_plate0 - A_7.5 e_coli_plate0      -0.0008286 0.000283 110.6  -2.926  0.0771
#  A_7.5 e_coli_plate0 - A_10 e_coli_plate1       0.0013138 0.000350 190.3   3.750  0.0056 #dont think we care
#  A_7.5 e_coli_plate0 - A_5 e_coli_plate1        0.0011733 0.000356 206.2   3.294  0.0252 #dont think we care
#  CNTRL_0 e_coli_plate0 - A_10 e_coli_plate1     0.0010798 0.000353 190.0   3.059  0.0508
#  A_10 e_coli_plate1 - A_7.5 e_coli_plate1      -0.0008286 0.000283 110.6  -2.926  0.0771

#Question: what is the relationship between E. coli and temperature?
emm_resp_2_temp_e_coli=emmeans(mm_resp_2, specs=pairwise ~ temp*e_coli_plate)
summary(emm_resp_2_temp_e_coli)
# contrast                                     estimate       SE  df t.ratio p.value
#  temp20 e_coli_plate0 - temp20 e_coli_plate1  0.000485 0.000205 318   2.366  0.0858
#  temp30 e_coli_plate0 - temp20 e_coli_plate1  0.000830 0.000279 353   2.973  0.0166
#  temp30 e_coli_plate0 - temp30 e_coli_plate1  0.000485 0.000205 318   2.366  0.0858

#corals treated with E. coli respired more than no E. coli at both temperatres


# Question: what is the relationship between N species dose and temperature?
emm_resp_2_N_dose_temp=emmeans(mm_resp_2, specs=pairwise ~ N_species_dose*temp)
summary(emm_resp_2_N_dose_temp)
 # contrast                         estimate       SE    df t.ratio p.value
 # A_10 temp20 - A_7.5 temp20      -0.000829 0.000283 110.6  -2.926  0.0771
 # A_10 temp20 - A_7.5 temp30      -0.001174 0.000345 162.2  -3.404  0.0186
 # A_5 temp20 - A_7.5 temp30       -0.001033 0.000342 188.2  -3.020  0.0567
 # A_10 temp30 - A_7.5 temp30      -0.000829 0.000283 110.6  -2.926  0.0771

# Question: what is the relationship between sym state and E. coli?
emm_resp_2_sym_state_e_coli=emmeans(mm_resp_2, specs=pairwise ~ sym_state*e_coli_plate)
summary(emm_resp_2_sym_state_e_coli)
 # contrast                            estimate       SE  df t.ratio p.value
 # A e_coli_plate0 - S e_coli_plate0  0.0005064 0.000227 195   2.230  0.1189
 # A e_coli_plate0 - A e_coli_plate1  0.0004851 0.000205 318   2.366  0.0858
 # A e_coli_plate0 - S e_coli_plate1  0.0009915 0.000312 246   3.182  0.0089
 # S e_coli_plate0 - A e_coli_plate1 -0.0000213 0.000300 258  -0.071  0.9999
 # S e_coli_plate0 - S e_coli_plate1  0.0004851 0.000205 318   2.366  0.0858
 # A e_coli_plate1 - S e_coli_plate1  0.0005064 0.000227 195   2.230  0.1189

# Question: what is the relationship between sym state and temperature?
emm_resp_2_sym_state_temp=emmeans(mm_resp_2, specs=pairwise ~ sym_state*temp)
summary(emm_resp_2_sym_state_temp)
 # contrast             estimate       SE  df t.ratio p.value
 # A temp20 - S temp20  0.000506 0.000227 195   2.230  0.1189
 # A temp20 - A temp30 -0.000345 0.000192 325  -1.792  0.2789
 # A temp20 - S temp30  0.000161 0.000297 293   0.543  0.9482
 # S temp20 - A temp30 -0.000851 0.000298 274  -2.853  0.0239
 # S temp20 - S temp30 -0.000345 0.000192 325  -1.792  0.2789
 # A temp30 - S temp30  0.000506 0.000227 195   2.230  0.1189

# Question: what is the relationship between sym state and Ammonium dose?
emm_resp_2_sym_state_N_species_dose=emmeans(mm_resp_2, specs=pairwise ~ sym_state*N_species_dose)
summary(emm_resp_2_sym_state_N_species_dose)
 # contrast                estimate       SE    df t.ratio p.value
 # A A_10 - A A_7.5      -0.0008286 0.000283 110.6  -2.926  0.0771
 # S A_10 - A A_7.5      -0.0013351 0.000361 199.7  -3.695  0.0068 **
 # S A_10 - S A_7.5      -0.0008286 0.000283 110.6  -2.926  0.0771
 # S A_10 - A CNTRL_0    -0.0011011 0.000367 177.4  -3.004  0.0596 **
 # S A_5 - A A_7.5       -0.0011946 0.000365 202.5  -3.269  0.0273 **

```

```{r Model interaction plots}
# Reminder: this is our model
mm_resp_2 <- lmer(resp_rate ~ N_species_dose + e_coli_plate + sym_state + temp + (1|vial_ID) + (1 | col_num), data=resp_all_ammonium.data)
summary(mm_resp_2)


#Model Interaction plot - ammonium
# I for some reason cannot simplify this I dont know why
int_ammonium<-lmer(resp_rate~N_species_dose*temp*sym_state*e_coli_plate+(1|col_num), data=resp_all_ammonium.data)
summary(int_ammonium)
int_pred_ammonium <- ggemmeans(int_ammonium, terms=c("N_species_dose", "sym_state", "temp","e_coli_plate")) # I cannot do more than 4 interactions 
pred_ammonium <- ggplot(int_pred_ammonium, aes(facet,predicted, colour = group)) +
  geom_point(aes(shape = x)) +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.3) +
  labs(x = "temp", y = "Rate O2 Consumption (umol*min-1*g-1)",
       color = "temp") +
  facet_grid(~panel) +
  ggtitle("test") +
  theme_classic() +
  theme(axis.title.x = element_text(color="black", size=12),
axis.title.y = element_text(color="black", size=12))+
  theme(axis.text.x = element_text(size=12),
          axis.text.y = element_text(size=12)) +
  scale_color_manual(values=c("black", "goldenrod"))
pred_ammonium

```

```{r Graphs by variable}
#Make N species dose a factor and give it levels so it will display in this order
resp_all_ammonium.data$N_species_dose <- factor(resp_all_ammonium.data$N_species_dose, levels=c("CNTRL_0", "A_5", "A_7.5","A_10"))

#Make everything else a character so they graph nicely 
resp_all_ammonium.data$treat_ID_full<-as.character(resp_all_ammonium.data$treat_ID_full)
resp_all_ammonium.data$e_coli_plate<-as.character(resp_all_ammonium.data$e_coli_plate)
resp_all_ammonium.data$temp <- as.character(resp_all_ammonium.data$temp)

# Summarize by N_species_dose so we can visualize
sum_N_species_dose_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("N_species_dose"))
# Visualize
gg_N_species_dose_ammonium<-ggplot(data = sum_N_species_dose_ammonium,
       aes(x = N_species_dose,
           y = resp_rate, col=N_species_dose)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium - N Species Dose summary") +
   theme(legend.position="none")+
    labs(x = "\n", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    scale_x_discrete("Ammonium dose", labels=c(CNTRL_0="Control", A_5="5uM", A_7.5="7.5uM", A_10="10uM"))+
    scale_color_manual(labels=labels, values=c("blue", "orchid1","blueviolet","purple4"))
gg_N_species_dose_ammonium

# Summarize by temperature so we can visualize
sum_temp_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("temp"))
# Visualize
gg_temp_ammonium<-ggplot(data = sum_temp_ammonium,
       aes(x = temp,
           y = resp_rate, col=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- Temperature summary") +
  theme(legend.position="none")+
    labs(x = "Temperature", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    scale_x_discrete("Temperature", labels=c("20"="Control 20C", "30"="Elevated 30C")) +
    scale_color_manual(labels=labels, values=c("blue", "red"))
gg_temp_ammonium

# Summarize by E. coli so we can visualize
sum_e_coli_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("e_coli_plate"))
# Visualize
gg_e_coli_ammonium<-ggplot(data = sum_e_coli_ammonium,
       aes(x = e_coli_plate,
           y = resp_rate, col=e_coli_plate)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- E. coli summary") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # scale_x_discrete(labels=c("20C","30C"))+
    theme(legend.position="none")+
    labs(x = "E. coli presence", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
        scale_x_discrete("E. coli presence", labels=c("0"="No E. coli", "1"="E. coli")) +
    scale_color_manual(labels=labels, values=c("gray", "darkgreen"))
gg_e_coli_ammonium

# Summarize by sym state so we can visualize
sum_sym_state_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("sym_state"))
# Visualize
gg_sym_state_ammonium<-ggplot(data = sum_sym_state_ammonium,
       aes(x = sym_state,
           y = resp_rate, col=sym_state)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- Sym state summary") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "Symbiotic state", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
        theme(legend.position="none")+
        scale_x_discrete("Symbiotic State", labels=c("A"="Apo", "S"="Symbiotic")) +
        scale_color_manual("Symbiotic state", labels=c("Aposymbiotic","Symbiotic"), values=c("gray", "brown"))
gg_sym_state_ammonium
summary(lm(resp_rate ~ sym_state, data=resp_all_ammonium.data))
# UGH THEY ARE DIFFERENT! But it doesnt  come up in the overall model

# Summarize by food so we can visualize
sum_food_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("food"))
# Visualize
gg_food_ammonium<-ggplot(data = sum_food_ammonium,
       aes(x = food,
           y = resp_rate, col=food)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- Food summary") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "Symbiotic state", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    theme(legend.position="none")+
   scale_x_discrete("Food presence", labels=c("F"="Fed", "S"="Starved")) +
  scale_color_manual("Food Regime", labels=c("Fed","Starved"),values=c("orange", "black"))
gg_food_ammonium
summary(lm(resp_rate ~ sym_state, data=resp_all_ammonium.data))


# Summarize by food and sym state so we can visualize
sum_food_sym_state_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("sym_state","food"))
# Visualize
gg_food_sym_state_ammonium<-ggplot(data = sum_food_sym_state_ammonium,
       aes(x = sym_state,
           y = resp_rate, col=food)) + #use fill here or the legends will be really hard to work with
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    ggtitle ("Ammonium- Sym state and food summary") +
   #scale_fill_manual(name="Feeding Regime", labels=c('Fed', 'Starved'))+
 # scale_fill_manual(values=c("brown", "darkgray"))+
    labs(x = "Symbiotic state", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
      scale_x_discrete(name="Symboitic state", labels=c("A"="Aposymbiotic", "S"="Symbiotic")) +
  # scale_fill_manual(values=c("brown", "darkgray"))
 scale_color_manual("Food Regime", labels=c("Fed","Starved"),values=c("orange", "black"))
gg_food_sym_state_ammonium #seems obvious that food doesnt matter

# Summarize by temp and N species dose so we can visualize
sum_N_species_dose_temp_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("temp","N_species_dose"))
sum_N_species_dose_temp_ammonium$N_species_dose <- factor(sum_N_species_dose_temp_ammonium$N_species_dose, levels=c("CNTRL_0", "A_5", "A_7.5","A_10"))
# Visualize
gg_N_species_dose_temp_ammonium<-ggplot(data = sum_N_species_dose_temp_ammonium,
       aes(x = N_species_dose,
           y = resp_rate, col=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium - N species dose and temperature summary") +
     
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "ammonium dose", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
 scale_x_discrete("Ammonium dose", labels=c(CNTRL_0="Control", A_5="5uM", A_7.5="7.5uM", A_10="10uM"))+
    scale_color_manual("Temperature",labels=c("20C","30C"), values=c("blue", "red"))
gg_N_species_dose_temp_ammonium 

# Summarize by e_coli and N species dose so we can visualize
sum_N_species_dose_e_coli_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("e_coli_plate","N_species_dose"))
sum_N_species_dose_e_coli_ammonium$N_species_dose <- factor(sum_N_species_dose_e_coli_ammonium$N_species_dose, levels=c("CNTRL_0", "A_5", "A_7.5","A_10"))
# Visualize
gg_N_species_dose_e_coli_ammonium<-ggplot(data = sum_N_species_dose_e_coli_ammonium,
       aes(x = N_species_dose,
           y = resp_rate, colour=e_coli_plate)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- N species dose and e coli summary") +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "Ammonium dose", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
   scale_x_discrete("ammonium dose", labels=c(CNTRL_0="Control", N_1.5="1.5uM", N_5="5uM", N_18="18uM"))+
     scale_color_manual("E.coli presence",labels=c("No E. coli", "E. coli"), values=c("gray", "darkgreen"))
gg_N_species_dose_e_coli_ammonium

# Summarize by e_coli and temp so we can visualize
sum_temp_e_coli_ammonium <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("e_coli_plate","temp"))
# Visualize
gg_temp_e_coli_ammonium<-ggplot(data = sum_temp_e_coli_ammonium,
       aes(x = e_coli_plate,
           y = resp_rate, colour=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- temperature and e coli summary") +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "E. coli", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
     scale_x_discrete("E. coli presence", labels=c("0"="No E. coli", "1"="E coli"))+
     scale_color_manual("Temperature",labels=c("20C","30C"), values=c("blue", "red"))
gg_temp_e_coli_ammonium


# Summarize by e_coli and temp so we can visualize
sum_dose_sym_state <- summarySE(resp_all_ammonium.data, measurevar = "resp_rate", groupvars = c("N_species_dose","sym_state"))
sum_dose_sym_state$N_species_dose <- factor(sum_dose_sym_state$N_species_dose, levels=c("CNTRL_0", "A_5", "A_7.5","A_10"))
# Visualize
gg_sum_dose_sym_state_ammonium<-ggplot(data = sum_dose_sym_state,
       aes(x = N_species_dose,
           y = resp_rate, colour=sym_state)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- dose and sym state summary") +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "E. coli", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    scale_x_discrete("Ammonium dose", labels=c(CNTRL_0="Control", A_5="5uM", A_7.5="7.5uM", A_10="10uM"))+
     scale_color_manual("Sym State",labels=c("Sym","Apo"), values=c("gray", "brown"))

gg_sum_dose_sym_state_ammonium

```



```{r Graphs - Plotting model estimates}
#Plot model estimate for N_species_dose # I am not sure how interesting this is, but here is the code if we want it
l=plot_model(mm_resp_2, 'pred', ci.lvl = 0.95, terms="N_species_dose")
l +
  theme_classic() +
xlab("N species dose")+
  ylab("Rate O2 Consumption (umol*min-1*g-1)")+
  ggtitle("")+
  theme(axis.title.x = element_text(color="black", size=14, face="bold"),
axis.title.y = element_text(color="black", size=14, face="bold"))+
  theme(axis.text.x = element_text(size=14),
          axis.text.y = element_text(size=14))
# plot model estimate for temp
t=plot_model(mm_resp_e_coli_2, 'pred', ci.lvl = 0.95, terms="N_species_dose")
t

```

```{r Plots for randi - models and graphs without controls}



ammonium_without_control <- read.csv("RESP_Ammonium_without_controls.csv", header=TRUE, sep=",",stringsAsFactors = FALSE)
ammonium_without_control <- na.omit(ammonium_without_control)
#make sure treatID is a character
ammonium_without_control$treat_ID_full<-as.character(ammonium_without_control$treat_ID_full)
ammonium_without_control$e_coli_plate<-as.character(ammonium_without_control$e_coli_plate)
ammonium_without_control$temp <- as.character(ammonium_without_control$temp)


full.model <- lmer(resp_rate ~  N_species_dose + temp + food + sym_state + e_coli_plate + N_species_dose*temp + N_species_dose*food + N_species_dose*sym_state + N_species_dose*e_coli_plate + temp*food + temp*sym_state + temp*e_coli_plate + food*sym_state + food*e_coli_plate + sym_state*e_coli_plate +  (1|col_num) + (1|exp_num) , data= ammonium_without_control)
print(step.model<- step(full.model))

mm_without_controls <-lmer(resp_rate ~ N_species_dose + temp + (1 | col_num), data=ammonium_without_control)

summary(mm_without_controls)

# Summarize by temperature
emm_temp=emmeans(mm_without_controls, specs=pairwise ~ temp)
summary(emm_temp)

#Pairwise by N species dose 
emm_N_species_dose=emmeans(mm_without_controls, specs=pairwise ~ N_species_dose)
summary(emm_N_species_dose)

# Visualize
sum_temp_ammonium <- summarySE(ammonium_without_control, measurevar = "resp_rate", groupvars = c("temp"))

gg_temp_ammonium<-ggplot(data = sum_temp_ammonium,
       aes(x = temp,
           y = resp_rate, col=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- Temperature and dose summary without controls") +
  theme(legend.position="none")+
    labs(x = "Temperature", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    scale_x_discrete("Temperature", labels=c("20"="Control 20C", "30"="Elevated 30C")) +
      scale_color_manual("Temperature",labels=c("20C","30C"), values=c("blue", "red"))
gg_temp_ammonium

```


```{r Looking at E. coli subsets}

# E. coli
sum_temp_dose_ammonium_e_coli <- summarySE(e_coli, measurevar = "resp_rate", groupvars = c("temp", "N_species_dose"))
sum_temp_dose_ammonium_e_coli$N_species_dose <- factor(sum_temp_dose_ammonium_e_coli$N_species_dose, levels=c("CNTRL_0", "A_5", "A_7.5","A_10"))

gg_sum_temp_dose_ammonium_e_coli<-ggplot(data = sum_temp_dose_ammonium_e_coli,
       aes(x = N_species_dose,
           y = resp_rate, col=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- Temperature and dose summary - E. coli treated corals") +
  theme(legend.position="none")+
    labs(x = "Ammonium dose", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
      scale_x_discrete("Ammonium dose", labels=c(CNTRL_0="Control", A_5="5uM", A_7.5="7.5uM", A_10="10uM"))+
    scale_color_manual(labels=labels, values=c("blue", "red"))
gg_sum_temp_dose_ammonium_e_coli

full.model.e_coli <- lmer(resp_rate ~  N_species_dose + temp + food + sym_state  + N_species_dose*temp + N_species_dose*food + N_species_dose*sym_state + temp*food + temp*sym_state +  food*sym_state +  (1|col_num) + (1|exp_num) , data= e_coli)
print(step.model<- step(full.model.e_coli))

summary(mm_e_coli <- lmer(resp_rate ~  N_species_dose + temp + (1|col_num), data= e_coli))

# Summarize by temperature
emm_temp=emmeans(mm_e_coli, specs=pairwise ~ temp*N_species_dose)
summary(emm_temp)
 # contrast                          estimate       SE  df t.ratio p.value
 # temp20 A_10 - temp20 A_7.5      -0.0011139 0.000391 160  -2.848  0.0908
 # temp20 A_10 - temp30 A_7.5      -0.0016759 0.000491 169  -3.415  0.0178 **
 # temp20 A_10 - temp30 CNTRL_0    -0.0016040 0.000489 165  -3.280  0.0272 **
 # temp30 A_10 - temp30 A_7.5      -0.0011139 0.000391 160  -2.848  0.0908


# No E. coli
sum_temp_dose_ammonium_no_e_coli <- summarySE(no_e_coli, measurevar = "resp_rate", groupvars = c("temp", "N_species_dose"))
sum_temp_dose_ammonium_no_e_coli$N_species_dose <- factor(sum_temp_dose_ammonium_no_e_coli$N_species_dose, levels=c("CNTRL_0", "A_5", "A_7.5","A_10"))

gg_sum_temp_dose_ammonium_no_e_coli<-ggplot(data = sum_temp_dose_ammonium_no_e_coli,
       aes(x = N_species_dose,
           y = resp_rate, col=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Ammonium- Temperature and dose summary - No E. coli treated corals") +
  theme(legend.position="none")+
    labs(x = "Ammonium dose", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
      scale_x_discrete("Ammonium dose", labels=c(CNTRL_0="Control", A_5="5uM", A_7.5="7.5uM", A_10="10uM"))+
    scale_color_manual(labels=labels, values=c("blue", "red"))
gg_sum_temp_dose_ammonium_no_e_coli

full.model.no_e_coli <- lmer(resp_rate ~  N_species_dose + temp + food + sym_state  + N_species_dose*temp + N_species_dose*food + N_species_dose*sym_state + temp*food + temp*sym_state +  food*sym_state +  (1|col_num) + (1|exp_num) , data= no_e_coli)
print(step.model<- step(full.model.no_e_coli))

summary(mm_no_e_coli <- lmer(resp_rate ~  N_species_dose + temp + (1|col_num), data= no_e_coli))

# Summarize by temperature
emm_temp=emmeans(mm_no_e_coli, specs=pairwise ~ temp*N_species_dose)
summary(emm_temp)
# NO STATISTICALLY SIGNIFICANT DIFFERENCES


```



```{r Looking at ammonium 10uM}
# We found in the above analyses that there was a statistically significant difference between Control and 10uM under E. coli. Let's zoom out and look at 10uM and see what might be driving that model 

#QUESTION: For corals at 10uM ammonium, is there a significant difference if you are 1) fed vs starved? NO 2) E. coli vs. no E. coli? No, but it looks close 3) sym vs apo? NO  4) 20 vs. 30C? NO

all_10uM<-subset(resp_all_ammonium.data, resp_all_ammonium.data$N_species_dose=="A_10")

full.model_all_10uM <- lmer(resp_rate ~ e_coli_plate + temp + food + sym_state + e_coli_plate*temp + e_coli_plate*food + e_coli_plate*sym_state + temp*food + temp*sym_state + food*sym_state + (1|vial_ID) +  (1|col_num) + (1|exp_num) + (1|exp_subrun), data= all_10uM)
summary(full.model_all_10uM)
print(step.model<- step(full.model_all_10uM))

#model it recommends:
mm_all_10uM<-lmer(resp_rate ~ e_coli_plate + temp + food + sym_state + (1 | col_num) + e_coli_plate:temp + e_coli_plate:food + e_coli_plate:sym_state, data=all_10uM)
summary(mm_all_10uM) # E. coli seems to be driving the model
#posthocs
emm_all_10uM_sym_state <- emmeans(mm_all_10uM, pairwise ~ sym_state)
summary(emm_all_10uM_sym_state)

#let's try it just on E. coli data at 10uM

e_coli_10uM<-subset(resp_all_ammonium.data, resp_all_ammonium.data$N_species_dose=="N_10" & resp_all_ammonium.data$e_coli_plate==1)
full.model_e_coli_10uM <- lmer(resp_rate ~ temp + food + sym_state + temp*food + temp*sym_state + food*sym_state + (1|vial_ID) +  (1|col_num) + (1|exp_num) + (1|exp_subrun), data= e_coli_10uM)
summary(full.model_e_coli_10uM)
print(step.model<- step((full.model_e_coli_10uM)))

summary(aov(e_coli_10uM$resp_rate ~ e_coli_10uM$temp))


#Let's 10uM and see what comes out
lm_all_10uM<- lm(resp_rate~e_coli_plate + temp + food + sym_state, data=all_10uM)
summary(lm_all_10uM)
# Summarize by E. coli -- it looks like there is a difference here, but it just doesn't come out as significant
all_10uM_sum_e_coli <- summarySE(all_10uM, measurevar = "resp_rate", groupvars = c("e_coli_plate"))
# Summarize by food
all_10uM_sum_food <- summarySE(all_10uM, measurevar = "resp_rate", groupvars = c("food"))
# Summarize by sym-state
all_10uM_sum_sym_state <- summarySE(all_10uM, measurevar = "resp_rate", groupvars = c("sym_state"))
# Summarize by temp
all_10uM_sum_temp <- summarySE(all_10uM, measurevar = "resp_rate", groupvars = c("temp"))
# Visualize
ggplot(data = all_10uM_sum_e_coli,
       aes(x = e_coli_plate,
           y = resp_rate)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("A 10uM - E. coli vs. No E. coli") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
    labs(x = "\n", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    theme_classic()

# What about 10uM treated with E. coli
e_coli_10uM<-subset(resp_all_ammonium.data, resp_all_ammonium.data$N_species_dose=="A_10" & resp_all_ammonium.data$e_coli_plate==1)
# Summarize by food
e_coli_10uM_sum_food <- summarySE(e_coli_10uM, measurevar = "resp_rate", groupvars = c("food"))
# Summarize by sym-state
e_coli_10uM_sum_sym_state <- summarySE(e_coli_10uM, measurevar = "resp_rate", groupvars = c("sym_state"))
# Summarize by temp
e_coli_10uM_sum_temp <- summarySE(e_coli_10uM, measurevar = "resp_rate", groupvars = c("temp"))
# Visualize
ggplot(data = e_coli_10uM_sum_food,
       aes(x = food,
           y = resp_rate)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("N 10uM with E. Coli - Fed vs. Starved") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
    labs(x = "\n", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    theme_classic()

```




```{r playing around with Sarahs code to see if there is an effect of E coli at every treatment}

#Generate a linear model and then use the log function on it
mm_resp_TREAT_ID <- lmer(resp_rate ~ treat_ID_collapsed_controls + (1|exp_num) + (1|col_num), data= resp_all_ammonium.data)
mm_resp_TREAT_ID_log<- Log(mm_resp_TREAT_ID)~e_coli_plate + (1|exp_num) + (1|col_num)
summary(mm_resp_TREAT_ID_log)

# Question: Is there a significant change of resp rate at each treatment ID under E coli?
# create grouping factor to run all linear models for each treatment at once
by_treat_all <- group_by(resp_all_ammonium.data, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_all <- 
  do(by_treat_all, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
print(response.lm_all)

# TEMP
#create grouping factor to run all linear models for each treatment at once
by_treat_20C<- group_by(all_20C, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_20C <- 
  do(by_treat_20C, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
response.lm_20C

# create grouping factor to run all linear models for each treatment at once
by_treat_30C<- group_by(all_30C, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_30C <- 
  do(by_treat_30C, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
response.lm_30C

# SYM STATE
#create grouping factor to run all linear models for each treatment at once
by_treat_sym<- group_by(all_sym, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_sym <- 
  do(by_treat_sym, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
response.lm_sym

# create grouping factor to run all linear models for each treatment at once
by_treat_apo<- group_by(all_apo, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_apo <- 
  do(by_treat_apo, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
response.lm_apo

```

# We are now going to subset just fed and just starved data and do linear models to compare results to the overall model
```{r Fed data}
#first let's subset all of the fed data
all_fed_ammonium<-subset(resp_all_ammonium.data, resp_all_ammonium.data$food=="F")
qqnorm(all_fed_ammonium$resp_rate) #looks good

#now let's do model selection
full.model_fed_ammonium <- lmer(resp_rate ~  N_species_dose + temp + sym_state + e_coli_plate + N_species_dose*temp +  N_species_dose*sym_state + N_species_dose*e_coli_plate + temp*sym_state + temp*e_coli_plate +  sym_state*e_coli_plate +  (1|col_num) + (1|exp_num) , data= all_fed_ammonium)
print(step.model<- step(full.model_fed_ammonium))

mm_fed_ammonium <- lmer(resp_rate ~  N_species_dose + temp + sym_state + e_coli_plate +  (1|col_num) , data= all_fed_ammonium)
summary(mm_fed_ammonium)
#E coli and n species dose came out significant

```


```{r Starved data}
#first let's subset all of the fed data
all_starved_ammonium<-subset(resp_all_ammonium.data, resp_all_ammonium.data$food=="S")
qqnorm(all_starved_ammonium$resp_rate) #looks good
full.model_starved_ammonium <- lmer(resp_rate ~  N_species_dose + temp + sym_state + e_coli_plate + N_species_dose*temp +  N_species_dose*sym_state + N_species_dose*e_coli_plate + temp*sym_state + temp*e_coli_plate +  sym_state*e_coli_plate +  (1|col_num) + (1|exp_num) , data= all_fed_ammonium)
print(step.model<- step(full.model_starved_ammonium))

mm_starved_ammonium <- lmer(resp_rate ~ N_species_dose + temp + sym_state + e_coli_plate +  (1|col_num) , data= all_starved_ammonium)
summary(mm_starved_ammonium)

#E coli and n species dose came out significant

```