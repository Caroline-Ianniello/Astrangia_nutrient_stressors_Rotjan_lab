---
title: "RGB_COMBINED"
author: "CFI"
date: "2024-06-24"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Install required packages}
require("knitr")

#install.packages("lmerTest")
library("lmerTest")
#install.packages("Matrix")
library("Matrix")
#install.packages("lme4")
library("lme4")
#install.packages("emmeans")
library("emmeans")
#install.packages("pbkrtest")
library("pbkrtest")
library("tidyverse")
library(tidyverse)
library("performance")
#install.packages("see")
library("see")
#install.packages("ggrepel")
library("ggrepel")
#install.packages("sjPlot") #for visualizing linear models
library(sjPlot)
#install.packages("MASS")
library(MASS)
#install.packages("glmmTMB") # for visualizing model checks
library(glmmTMB)
#install.packages("relaimpo") #for quantifying the effects of predictor variables
library(relaimpo)
#install.packages("outliers") #for checking out whether a data point is an outlier
library(outliers)
library(Rmisc)
#install.packages("ggeffects")
library(ggeffects)
library(forestmodel)

#turn off scientific notation
options(scipen=999)

#let dplyr print a bunch of numbers
options(dplyr.print_max = 1e9)
options(max.print = 10000)   

```




```{r Set working directory and upload data - nitrate DATA ONLY}
# RGB_preprocess.data <- read.csv("C:/Users/carol/OneDrive/Documents/PhD Boston University 2019-/Astrangia_nutrient_stressors_Rotjan_lab/Data/RGB_ALL_Recomputted_dead_deleted_5_19_24.csv", header=TRUE, sep=",",stringsAsFactors = FALSE)
# 
# 
# #Create a NEW column for nitrate with new categories
# 
# RGB_preprocess.data <- RGB_preprocess.data %>%
#   mutate(NO3_category = case_when(
#    NO3_mean_observed < 6  ~ "Low" , #need two equal signs
#      NO3_mean_observed >= 6 ~ "Elevated" 
#    )
# )
# 
# 
# 
# #any single datapoint that was over 4 times disparate of mean or median from rest of treatment was discarded
#
# ^ did all that pre-processing then confirmed duplicates in excel spreadhseet. Now we can just read the csv

#QCed and all dead HAVE BEEN deleted, all IDs agree between PAM, RGB, and survival --6.26.24
RGB_all.data<- read.csv("C:/Users/carol/OneDrive/Documents/PhD Boston University 2019-/Astrangia_nutrient_stressors_Rotjan_lab/Data/RGB_recomputed_dead_deleted_combined_NO3categorized_6_26_24.csv", header=TRUE, sep=",",stringsAsFactors = FALSE)

count(RGB_all.data$NO3_category)
#188 elevated observations
#738 low observations





```
```{r Difference between RGB and survival - SORTED}
# #add survival data to see what observations are missing
# survival_all.data<- read.csv("C:/Users/carol/OneDrive/Documents/PhD Boston University 2019-/Astrangia_nutrient_stressors_Rotjan_lab/Data/Survival_06_26_24.csv", header=TRUE, sep=",",stringsAsFactors = FALSE)
# 
# 
# in_survival_not_RGB <- survival_all.data %>% 
#       filter(!survival_all.data$beetag_exprun %in% RGB_all.data$beetag_exprun) #RGBs not in survival
# notinRGB_butinsurvival <- data.frame(count(in_survival_not_RGB$beetag_exprun))
# #For df1 values not in df2
# 
# in_RGB_not_survival <- RGB_all.data %>% 
#       filter(!RGB_all.data$beetag_exprun %in% survival_all.data$beetag_exprun) #survivals not in RGB
# notinsurvival_RGB <- data.frame(count(in_RGB_not_survival$beetag_exprun))
# 
# 
# write.csv(notinRGB_butinsurvival, "C:/Users/carol/OneDrive/Documents/PhD Boston University 2019-/Astrangia_nutrient_stressors_Rotjan_lab/Data/notinRGB_butinsurvival.csv")
# 
# write.csv(notinsurvival_RGB, "C:/Users/carol/OneDrive/Documents/PhD Boston University 2019-/Astrangia_nutrient_stressors_Rotjan_lab/Data/notinsurvival_RGB.csv")
```

```{r Generating subsets to work with}

RGB_all.data$NO3_category <- factor(RGB_all.data$NO3_category, levels=c("Low", "Elevated"))
RGB_all.data$sym_state<- as.factor(RGB_all.data$sym_state)
RGB_all.data$food<- as.factor(RGB_all.data$food)
RGB_all.data$temp<- as.factor(RGB_all.data$temp)
#SUBSET - 20C
RGB_20 <- RGB_all.data %>%
  filter(temp==20)
#SUBSET - 30C
RGB_30 <- RGB_all.data %>%
  filter(temp==30)






```

```{r T tests}
#selected t tests

#Nitrate category
t.test(red_delta ~ NO3_category, data= RGB_all.data)
#no diff
t.test(red_delta ~ NO3_category, data= RGB_20)
#no diff
t.test(red_delta ~ NO3_category, data= RGB_30)
#no diff

#Sym state
t.test(red_delta ~ sym_state, data= RGB_all.data)
#no diff
t.test(red_delta ~ sym_state, data= RGB_20)
#no diff
t.test(red_delta ~ sym_state, data= RGB_30)
#no diff


#Food
t.test(red_delta ~ food, data= RGB_all.data)
#no diff
t.test(red_delta ~ food, data= RGB_20)
#no diff
t.test(red_delta ~ food, data= RGB_30)
#no diff


#Temp
t.test(red_delta ~ temp, data= RGB_all.data)
#corals in 30C overall gained, corals in 20C overall lost (makes sense re: sym phys)


#Nothing seems to matter! Slay
```

```{r ANOVAs to match graphs}
hist(RGB_all.data$red_delta) #nice and normal

#Now an ANOVA on sym state, temp, and NO3_category 
anova_RGB <- aov(red_delta ~ sym_state*temp*NO3_category, data=RGB_all.data)
summary(anova_RGB )
#ptemp = 0.0146
TukeyHSD(anova_RGB )


```


#For Manuscript
```{r}
sum_sym_temp_nitrate_RGB <- summarySE(RGB_all.data, measurevar = "red_delta", groupvars = c("sym_state", "temp", "NO3_category"))
# Visualize
gg_sum_sym_temp_nitrate_RGB <-ggplot(data = sum_sym_temp_nitrate_RGB ,
       aes(x = NO3_category,
           y = red_delta, col=temp, shape=sym_state)) +
    geom_point(size=4) +
    geom_errorbar(aes(ymin=red_delta-se, ymax=red_delta+se), width=0.25, linewidth=0.8) +
    ggtitle ("Delta Red Channel Value by Sym State and Temp") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 10),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
    ylim(-10, 8) +
   ##scale_x_discrete("Nitrate Level", labels=c("0-6uM","6-10uM","10-20uM","10uM"))+
    labs(x = "Nitrate Dose", 
         y = expression(paste("Delta Red Channel value")), 
         caption = "data represent mean +/- SEM" ) +
       # theme(legend.position="none")+
  scale_shape_discrete("Symbiotic state", labels=c("Aposymbiotic","Symbiotic")) +
    scale_color_manual("Temperature", labels=c("20°C","30°C"), values=c("dodgerblue", "darkred"))

gg_sum_sym_temp_nitrate_RGB 

```

