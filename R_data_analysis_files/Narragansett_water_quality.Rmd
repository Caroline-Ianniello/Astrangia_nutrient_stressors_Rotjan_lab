---
title: "Narragansett Water Quality"
author: "CFI"
date: "2024-06-28"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r Install required packages}
require("knitr")

#install.packages("lmerTest")
library("lmerTest")
#install.packages("Matrix")
library("Matrix")
#install.packages("lme4")
library("lme4")
#install.packages("emmeans")
library("emmeans")
#install.packages("pbkrtest")
library("pbkrtest")
library("tidyverse")
library(tidyverse)
library("performance")
#install.packages("see")
library("see")
#install.packages("ggrepel")
library("ggrepel")
#install.packages("sjPlot") #for visualizing linear models
library(sjPlot)
#install.packages("MASS")
library(MASS)
#install.packages("glmmTMB") # for visualizing model checks
library(glmmTMB)
#install.packages("relaimpo") #for quantifying the effects of predictor variables
library(relaimpo)
#install.packages("outliers") #for checking out whether a data point is an outlier
library(outliers)
library(Rmisc)
#install.packages("ggeffects")
library(ggeffects)
library(forestmodel)

#turn off scientific notation
options(scipen=999)

#let dplyr print a bunch of numbers
options(dplyr.print_max = 1e9)
options(max.print = 10000)   

```


```{r}
narragansett_water_qual.data <- read.csv("C:/Users/carol/OneDrive/Documents/PhD Boston University 2019-/Astrangia_nutrient_stressors_Rotjan_lab/Data/Narragansett_water_qual_2019_2021.csv", header=TRUE, sep=",",stringsAsFactors = FALSE)

#I think we just want upper, and stations:
#2 which is Conimicut point
#5 Which is the GSO dock
#8 which is Jamestown
# Also categorize by season

#Add season
narragansett_water_qual.data <- narragansett_water_qual.data  %>% mutate(season = case_when(
    sample_month=="January" | sample_month=="February" | sample_month=="March" ~ "Winter" , #need two equal signs
      sample_month=="April" | sample_month=="May" | sample_month=="June" ~ "Spring" ,
    sample_month=="July" | sample_month=="August" | sample_month=="September" ~ "Summer" ,
    sample_month=="October" | sample_month=="November" | sample_month=="December" ~ "Fall" 
  )
)

#Filter
narragansett_water_qual.data$station_num <- as.numeric(narragansett_water_qual.data$station_num)
narragansett_water_qual.data <- narragansett_water_qual.data %>%
  filter(station_num == 2 | station_num == 5 | station_num == 8 )

#Recategorize by season
narragansett_water_qual.data <- narragansett_water_qual.data  %>% mutate(location = case_when(
    station_num==2  ~ "Conimicut Point" , #need two equal signs
      station_num==5  ~ "GSO Dock" , 
    station_num==8  ~ "Jamestown" 
  )
)


#now we have all depths, let's visualize
```

```{r}
narragansett_water_qual.data$season <- factor(narragansett_water_qual.data$season, levels=c("Winter","Spring","Summer","Fall"))
narragansett_water_qual.data$location <- factor(narragansett_water_qual.data$location, levels=c("Conimicut Point","GSO Dock","Jamestown"))

narragansett_water_qual.data<-narragansett_water_qual.data %>% 
  mutate(sample_year=as.factor(sample_year)) %>%
  mutate(sample_month=factor(sample_month, levels=c("January","February","March","April","May","June","July","August","September","October","November","December")))

# NITRATE
#Summarize by location, nitrate, season
sum_wq_narra_nitrate <- summarySE(narragansett_water_qual.data, measurevar = c("nitrate"), groupvars = c("location", "season"))
gg_sum_wq_narra_nitrate <-ggplot(data = sum_wq_narra_nitrate ,
       aes(x = season,
           y = nitrate, col=location)) +
    geom_point(size=4) +
    geom_errorbar(aes(ymin=nitrate-se, ymax=nitrate+se), width=0.25, linewidth=0.8) +
    ggtitle ("Nitrate Averages Across Years in Narragansett Bay, 2019-2021") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 10),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # ylim(-10, 8) +
   ##scale_x_discrete("Nitrate Level", labels=c("0-6uM","6-10uM","10-20uM","10uM"))+
    labs(x = "Season", 
         y = expression(paste("Nitrate uM")), 
         caption = "data represent mean +/- SEM" ) 
       # theme(legend.position="none")+
    #scale_color_manual("Temperature", labels=c("20°C","30°C"), values=c("dodgerblue", "darkred"))

gg_sum_wq_narra_nitrate

#By month
sum_month_year_wq_narra_nitrate <- summarySE(narragansett_water_qual.data, measurevar = c("nitrate"), groupvars = c("location", "sample_month","sample_year"), na.rm=T)
gg_sum_month_year_wq_narra_nitrate <-ggplot(data = sum_month_year_wq_narra_nitrate ,
       aes(x = sample_month,
           y = nitrate, col=location, shape=sample_year, group=interaction(sample_year,location))) +
    geom_point(size=3) +
 geom_line(linetype="dotted")+
    geom_errorbar(aes(ymin=nitrate-se, ymax=nitrate+se), width=0.25, linewidth=0.8) +
    ggtitle ("Nitrate Averages Across Years in Narragansett Bay, 2019-2021") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 10),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 10)) +
    ylim(0, 26) +
   ##scale_x_discrete("Nitrate Level", labels=c("0-6uM","6-10uM","10-20uM","10uM"))+
    labs(x = "Season", 
         y = expression(paste("Nitrate uM")), 
         caption = "data represent mean +/- SEM" ) +
           scale_color_manual("Location", values=c("#EC407A", "#43A047", "#00BCD4")) +
scale_shape_discrete("Year")
gg_sum_month_year_wq_narra_nitrate

```

```{r}
#By month
sum_month_year_wq_narra_ammonia <- summarySE(narragansett_water_qual.data, measurevar = c("ammonia"), groupvars = c("location", "sample_month","sample_year"), na.rm=T)
sum_month_year_wq_narra_ammonia <- summarySE(narragansett_water_qual.data, measurevar = c("ammonia"), groupvars = c("location", "sample_month","sample_year"), na.rm=T)
gg_sum_month_year_wq_narra_ammonia <-ggplot(data = sum_month_year_wq_narra_ammonia ,
       aes(x = sample_month,
           y = ammonia, col=location, shape=sample_year, group=interaction(sample_year,location))) +
    geom_point(size=3) +
 geom_line(linetype="dotted")+
    geom_errorbar(aes(ymin=ammonia-se, ymax=ammonia+se), width=0.25, linewidth=0.8) +
    ggtitle ("Ammonia Averages Across Years in Narragansett Bay, 2019-2021") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 10),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 10)) +
 ylim(0, 37) +
   ##scale_x_discrete("ammonia Level", labels=c("0-6uM","6-10uM","10-20uM","10uM"))+
    labs(x = "Season", 
         y = expression(paste("Ammonia uM")), 
         caption = "data represent mean +/- SEM" ) +
       # theme(legend.position="none")+
    scale_color_manual("Location", values=c("#EC407A", "#43A047", "#00BCD4")) +
scale_shape_discrete("Year")
gg_sum_month_year_wq_narra_ammonia
```


