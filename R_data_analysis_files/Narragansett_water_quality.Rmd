---
title: "Narragansett Water Quality"
author: "CFI"
date: "2024-06-28"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r Install required packages}
require("knitr")

#install.packages("lmerTest")
library("lmerTest")
#install.packages("Matrix")
library("Matrix")
#install.packages("lme4")
library("lme4")
#install.packages("emmeans")
library("emmeans")
#install.packages("pbkrtest")
library("pbkrtest")
library("tidyverse")
library(tidyverse)
library("performance")
#install.packages("see")
library("see")
#install.packages("ggrepel")
library("ggrepel")
#install.packages("sjPlot") #for visualizing linear models
library(sjPlot)
#install.packages("MASS")
library(MASS)
#install.packages("glmmTMB") # for visualizing model checks
library(glmmTMB)
#install.packages("relaimpo") #for quantifying the effects of predictor variables
library(relaimpo)
#install.packages("outliers") #for checking out whether a data point is an outlier
library(outliers)
library(Rmisc)
#install.packages("ggeffects")
library(ggeffects)
library(forestmodel)

#turn off scientific notation
options(scipen=999)

#let dplyr print a bunch of numbers
options(dplyr.print_max = 1e9)
options(max.print = 10000)   

```


```{r}
narragansett_water_qual.data <- read.csv("/Users/carolineianniello/Astrangia_Ecotox/Data/Narragansett_water_qual_2014_2022_QCed_8_22_24.csv", header=TRUE, sep=",",stringsAsFactors = FALSE)

#I think we just want upper, and stations:
#2 which is Conimicut point
#5 Which is the GSO dock
#8 which is Jamestown
# Also categorize by season

#Add months
narragansett_water_qual.data <- narragansett_water_qual.data  %>% mutate(sample_month = case_when(
   month== 1 ~ "January",
   month==2 ~ "February",
   month==3 ~ "March",
   month==4 ~ "April",
   month==5 ~ "May",
   month==6 ~  "June",
   month==7 ~  "July",
   month==8 ~  "August",
   month==9 ~  "September",
   month==10 ~ "October",
   month==11 ~ "November",
   month==12 ~ "December"
)
)


#Add season
narragansett_water_qual.data <- narragansett_water_qual.data  %>% mutate(season = case_when(
    sample_month=="January" | sample_month=="February" | sample_month=="March" ~ "Winter" , #need two equal signs
      sample_month=="April" | sample_month=="May" | sample_month=="June" ~ "Spring" ,
    sample_month=="July" | sample_month=="August" | sample_month=="September" ~ "Summer" ,
    sample_month=="October" | sample_month=="November" | sample_month=="December" ~ "Fall" 
  )
)

#Filter
narragansett_water_qual.data$station <- as.numeric(narragansett_water_qual.data$station)

narragansett_water_qual.data <- narragansett_water_qual.data %>%
  filter(station == 2 | station == 8 ) %>%
  filter(year >= 2018) %>%
  filter(depth=="surface")

#Recategorize by season
narragansett_water_qual.data <- narragansett_water_qual.data  %>% mutate(location = case_when(
    station==2  ~ "Conimicut Point" , #need two equal signs
    station==8  ~ "Jamestown" 
  )
)


#now we have all depths, let's visualize
```

```{r FOR MANUSCRIPT -- Nitrate over months}
narragansett_water_qual.data$season <- factor(narragansett_water_qual.data$season, levels=c("Winter","Spring","Summer","Fall"))
narragansett_water_qual.data$location <- factor(narragansett_water_qual.data$location, levels=c("Conimicut Point","GSO Dock","Jamestown"))

narragansett_water_qual.data<-narragansett_water_qual.data %>% 
  mutate(sample_year=as.factor(year)) %>%
  mutate(sample_month=factor(month, levels=c("January","February","March","April","May","June","July","August","September","October","November","December")))

narragansett_water_qual.data$nitrate.uml <- as.numeric(narragansett_water_qual.data$nitrate.uml)
hist(narragansett_water_qual.data$nitrate.uml)

# NITRATE
sum_month_year_wq_narra_nitrate <- summarySE(narragansett_water_qual.data, measurevar = c("nitrate.uml"), groupvars = c("location", "month","year"), na.rm=T)
sum_month_year_wq_narra_nitrate$year <- as.factor(sum_month_year_wq_narra_nitrate$year)
sum_month_year_wq_narra_nitrate$month <-as.factor(sum_month_year_wq_narra_nitrate$month)

gg_sum_month_year_wq_narra_nitrate <-ggplot(data = sum_month_year_wq_narra_nitrate ,
       aes(x = month,
           y = nitrate.uml, col=year, shape=location, group=interaction(year,location))) +
    geom_point( size=6, position = position_dodge(width = 0.45), stroke=2) +
 geom_line(linetype="dotted", size=1, position = position_dodge(width = 0.45))+
    geom_errorbar(aes(ymin=nitrate.uml-se, ymax=nitrate.uml+se), width=0.25, linewidth=0.8, position = position_dodge(width = 0.45))+
    ggtitle (" ") +
  theme_classic() +
  theme(legend.position = "right",  # Keep legend in second plot
        axis.text = element_text(size = 18),
        axis.text.x = element_text(size = 18),
        text = element_text(family = "serif", size = 20),
        legend.key.size = unit(2, 'lines')) +
   scale_x_discrete(labels=c("January","February","March","April", "May","June","July","August","September","October","November","December"))+
    labs(x = "Month", 
         y = expression(paste("Nitrate uM"))) +
         scale_color_manual("Year", values=c("#AF1DA8","#3416AA","#1757D7","#2CD4EE","#55B97F"), labels=c("2018","2019","2020","2021","2022")) +
scale_shape_manual("Location", values=c(15, 1), labels=c("Conimicut Point","Jamestown"))
         
gg_sum_month_year_wq_narra_nitrate
ggsave(file="Figures/gg_sum_month_year_wq_narra_nitrate.svg", plot=gg_sum_month_year_wq_narra_nitrate, device='svg')
ggsave(file="Figures/gg_sum_month_year_wq_narra_nitrate.png", plot=gg_sum_month_year_wq_narra_nitrate)

```

```{r TEMPERATURE}
sum_month_year_wq_narra_temp <- summarySE(narragansett_water_qual.data, measurevar = c("temperature.celsius"), groupvars = c("location", "month","year"), na.rm=T)
sum_month_year_wq_narra_temp$year <- as.factor(sum_month_year_wq_narra_temp$year)
sum_month_year_wq_narra_temp$month <-as.factor(sum_month_year_wq_narra_temp$month)

gg_sum_month_year_wq_narra_temp <-ggplot(data = sum_month_year_wq_narra_temp,
       aes(x = month,
           y = temperature.celsius, col=year, shape=location, group=interaction(year,location))) +
    geom_point( size=6, position = position_dodge(width = 0.45), stroke=2) +
 geom_line(linetype="dotted", size=1, position = position_dodge(width = 0.45))+
    geom_errorbar(aes(ymin=temperature.celsius-se, ymax=temperature.celsius+se), width=0.25, linewidth=0.8, position = position_dodge(width = 0.45))+
    ggtitle (" ") +
  theme_classic() +
  theme(legend.position = "right",  # Keep legend in second plot
        axis.text = element_text(size = 18),
        axis.text.x = element_text(size = 18),
        text = element_text(family = "serif", size = 20),
        legend.key.size = unit(2, 'lines')) +
   scale_x_discrete(labels=c("January","February","March","April", "May","June","July","August","September","October","November","December"))+
    labs(x = "Month", 
         y = expression(paste("Temperature Â°C"))) +
         scale_color_manual("Year", values=c("#AF1DA8","#3416AA","#1757D7","#2CD4EE","#55B97F"), labels=c("2018","2019","2020","2021","2022")) +
scale_shape_manual("Location", values=c(15, 1), labels=c("Conimicut Point","Jamestown")) +
  scale_y_continuous(breaks=seq(0,35, by=5))
         
gg_sum_month_year_wq_narra_temp
ggsave(file="Figures/gg_sum_month_year_wq_narra_temp.svg", plot=gg_sum_month_year_wq_narra_tempe, device='svg')
ggsave(file="Figures/gg_sum_month_year_wq_narra_temp.png", plot=gg_sum_month_year_wq_narra_temp)

```

```{r}
#Mean summertime temperature 

narragansett_water_qual.data_SUMMER <- narragansett_water_qual.data %>%
  filter(season=="Summer")
summer_summary_temp  <- summarySE(narragansett_water_qual.data_SUMMER, measurevar = c("temperature.celsius"), na.rm=T)
```

