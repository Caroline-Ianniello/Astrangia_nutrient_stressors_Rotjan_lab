---
title: "Respirometry data analysis (NITRATE) C. Fleming Last updated: 2/24/23"
output:
  pdf_document: default
  html_notebook: default
authors: Caroline Fleming

#Some resources:
  #https://rstudio-pubs-static.s3.amazonaws.com/63556_e35cc7e2dfb54a5bb551f3fa4b3ec4ae.html

#### NITRATE ### New & improved! With updated nitrate only controls
---

```{r Install required packages}
require("knitr")

library("tidyverse")
#install.packages("lmerTest")
library("lmerTest")
#install.packages("Matrix")
library("Matrix")
#install.packages("lme4")
library("lme4")
#install.packages("emmeans")
library("emmeans")
#install.packages("pbkrtest")
library("pbkrtest")
library("performance")
#install.packages("see")
library("see")
#install.packages("ggrepel")
library("ggrepel")
#install.packages("sjPlot") #for visualizing linear models
library(sjPlot)
#install.packages("MASS")
library(MASS)
#install.packages("glmmTMB") # for visualizing model checks
library(glmmTMB)
#install.packages("relaimpo") #for quantifying the effects of predictor variables
library(relaimpo)
#install.packages("outliers") #for checking out whether a data point is an outlier
library(outliers)
library(Rmisc)
#install.packages("ggeffects")
library(ggeffects)

#turn off scientific notation
options(scipen=999)

#let dplyr print a bunch of numbers
options(dplyr.print_max = 1e9)
options(max.print = 10000)   

```


```{r Set working directory and upload data - NITRATE DATA ONLY}
#opts_knit$set(root.dir = "C:/Users/carol/Documents/PhD Boston University 2019-/Chapter_2_Ecotox/Summer_2022_N_Ecotox/N_Ecotox_Chapter_2_ANALYSIS/Astrangia_nutrient_stressors_Rotjan_lab")
#getwd()

# We made a separate Nitrate excel file now so we're all set to upload & go
resp_all_nitrate.data <- read.csv("RESP_Nitrate_Cleaned.csv", header=TRUE, sep=",",stringsAsFactors = FALSE)
resp_all_nitrate.data<-na.omit(resp_all_nitrate.data)
hist(resp_all_nitrate.data$resp_rate) #slight skew but we're okay let's keep using it
qqnorm(resp_all_nitrate.data$resp_rate) #this looks really nice

#make sure treatID is a character
resp_all_nitrate.data$treat_ID_full<-as.character(resp_all_nitrate.data$treat_ID_full)

# #adding a log transformed resp rate
# resp_all_nitrate.data$log_resp_rate<-abs(resp_all_nitrate.data$resp_rate)
# resp_all_nitrate.data$log_resp_rate<-log(resp_all_nitrate.data$log_resp_rate)
# resp_all_nitrate.data$arcsin_resp_rate<-asin(resp_all_nitrate.data$resp_rate)
# 
# #testing for normality
# #TESTING FOR NORMALITY IN PAM_delta
# #install new package to see what the best transformation is
# #install.packages("bestNormalize")
# library("bestNormalize")
# bestNormalize(resp_all_nitrate.data$resp_rate)
# #in order for this to work I need to change the PAM_delta in to a vector
# resp_all_nitrate.data$resp_rate_vector<-as.vector(resp_all_nitrate.data$resp_rate_vector)
# #then I run the orderNorm command into a new object
# orderNormobj_resp_rate<-orderNorm(resp_all_nitrate.data$resp_rate)
# #this object gives us what we want, but we have to index from that object and put it in a new column
# resp_all_nitrate.data$ordernorm_resp_rate<-orderNormobj_resp_rate$x.t
# 
# Essential subsets
all_20C<-subset(resp_all_nitrate.data, resp_all_nitrate.data$temp==20)
all_30C<-subset(resp_all_nitrate.data, resp_all_nitrate.data$temp==30)
all_apo<-subset(resp_all_nitrate.data, resp_all_nitrate.data$sym_state=="A")
all_sym<-subset(resp_all_nitrate.data, resp_all_nitrate.data$sym_state=="S")
e_coli<-subset(resp_all_nitrate.data, resp_all_nitrate.data$e_coli_plate=="1")
no_e_coli<-subset(resp_all_nitrate.data, resp_all_nitrate.data$e_coli_plate=="0")
```


#Linear models

```{r linear models - ALL NITRATE DATA}
mm_resp_null <- lmer(resp_rate ~ 1 + (1|vial_ID) + (1|col_num) + (1|exp_num) +(1|exp_subrun) +(1|jar_unique_ID) + (1|resp_run) , data= resp_all_nitrate.data)
summary(mm_resp_null)
#that null looks good, intercept is significant

resp_random_model <- lmer(resp_rate ~ N_species_dose + food +(1|vial_ID), data=resp_all_nitrate.data)
summary(resp_random_model)



#full model with all interactions possible
mm_resp_1 <- lmer(resp_rate ~  N_species_dose + temp + food + sym_state + e_coli_plate + N_species_dose*temp + N_species_dose*food + N_species_dose*sym_state + N_species_dose*e_coli_plate + temp*food + temp*sym_state + temp*e_coli_plate + food*sym_state + food*e_coli_plate + sym_state*e_coli_plate + (1|vial_ID) +  (1|col_num) + (1|exp_num) + (1|exp_subrun), data= resp_all_nitrate.data)
summary(mm_resp_1)
#WARNING:
# boundary (singular) fit: see help('isSingular')
help('isSingular')

# OKAY NOW LETS TRY TO DO A STEPWISE LINEAR REGRESSION A LA RANDI's SUGGESTION
# This stepwise function includes random effects, but does not like random effects that cause singularity so I had to get rid of a bunch of them
full.model <- lmer(resp_rate ~  N_species_dose + temp + food + sym_state + e_coli_plate + N_species_dose*temp + N_species_dose*food + N_species_dose*sym_state + N_species_dose*e_coli_plate + temp*food + temp*sym_state + temp*e_coli_plate + food*sym_state + food*e_coli_plate + sym_state*e_coli_plate +  + (1|vial_ID) +  (1|col_num) + (1|exp_num) + (1|exp_subrun), data= resp_all_nitrate.data)
print(step.model<- step(full.model))

#The model did NOT select sym_state as informative, p value of 0.2

# here is the model that it recommends
mm_resp_2 <- lmer(resp_rate ~ N_species_dose + temp + e_coli_plate + (1 | col_num) + N_species_dose*e_coli_plate, data=resp_all_nitrate.data)
summary(mm_resp_2)

dose_aov<- aov(resp_all_nitrate.data$resp_rate ~ resp_all_nitrate.data$N_species_dose)
TukeyHSD(dose_aov)

mm_resp_4 <- lmer(resp_rate ~ N_species_dose + temp + e_coli_plate + sym_state+ (1 | col_num) + N_species_dose*e_coli_plate, data=resp_all_nitrate.data)
summary(mm_resp_4)

AIC(mm_resp_2, mm_resp_4)

# lets add sym state for fun and see what happens
mm_resp_3 <- lmer(resp_rate ~ N_species_dose + temp + e_coli_plate + sym_state + (1 | col_num), data=resp_all_nitrate.data)
summary(mm_resp_3) #still not significant, let's keep it out. This is a bit weird! OUR FREAKING GRAPH SAYS OTHERWISE



#  CHECKING MODEL FITNESS AND VISUALIZING MODEL for our winning model mm_resp_2
#checking for model fit
plot(mm_resp_2) #homogeneity of variance,looks okay--they are relatively distributed around 0
r2(mm_resp_2) #marginal id variance just by fixed factors, conditional includes variance explained by random factor
  # treatment explains 2.8% of variation
  # Random effects 28% genetic effect 
# !!!!!!!!!!!!! WEE WOO LOOK INTO THIS !!!!!!!!!!!!!!!!!!
check_collinearity(mm_resp_2) #There is correlation
check_outliers(mm_resp_2) #it looks like there might be an outlier so let's look into this
grubbs.test(resp_all_nitrate.data$resp_rate) # No outlier

check_heteroscedasticity(mm_resp_2) #heteroscadasticity detected
check_homogeneity(mm_resp_2) #variances different between groups
check_autocorrelation(mm_resp_2) #all good, there is independence
#Now this command will plot all of our model diagnostics to visualize them
plot_model(mm_resp_2, type="diag") #everything looks pretty good
#lowest value -0.0125 is an outlier, this is polyp G28Y65_exp1A

#checking out the contribution of each variable to the mode
summary(mm_resp_2)$coef
#we can just interpret t as an index of how important the effect is without trying to use some p-value to describe it

#looking at just the random effect part of the model
VarCorr(mm_resp_2) #not really sure how to interpret this

plot_model(mm_resp_2, "eff") # plots the predicted effects of each variable on respiration rate 
plot_model(mm_resp_2, type="re") # plots random effects

plot_model(mm_resp_2)
tab_model(mm_resp_2, digits=7) #adding digits tells it to include more decimal places

#let's try using the package relaimpo to give us a sense of the relative contribution of each variable to the model
# link for info on this package: https://advstats.psychstat.org/book/mregression/importance.php
library(relaimpo)
lm_resp_2_relimp <- lm(resp_rate ~ factor(N_species_dose) + factor(sym_state) + factor(temp) + 
    factor(e_coli_plate), data = resp_all_nitrate.data) #for some reason this code would not run unless I treated them as factors
calc.relimp(lm_resp_2_relimp, type="lmg", rela=TRUE)
#need to identify exactly what lmg means
```

```{r What is the effect of genet on respiration rate}
#just doing this for fun because I'm curious
mm_resp_genet <- lm(resp_rate ~ col_num, data= resp_all_nitrate.data)
summary(mm_resp_genet)
r2(mm_resp_genet)

resp_all_nitrate.data$col_num<-as.character(resp_all_nitrate.data$col_num)

#let's plot genets to check it out
gg_genet_nitrate<-ggplot(data = resp_all_nitrate.data,
       aes(x = col_num,
           y = resp_rate, col=col_num)) +
    geom_point() +
    #geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate - Genet summary") +
   # theme(legend.position = "right",
          # legend.title = element_text(size=12),
          # axis.title = element_text(size = 12),
          # legend.background = element_blank(),
          # panel.grid.major = element_blank(), 
          # panel.grid.minor = element_blank(),
          # axis.text = element_text(size = 12)) +
   legend.position=”none” +
    labs(x = "Genet", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    theme_classic()
gg_genet_nitrate

```

```{r Posthocs}
# Reminder: this is our model
mm_resp_2 <- lmer(resp_rate ~ N_species_dose + temp + e_coli_plate + (1 | col_num) + N_species_dose*e_coli_plate, data=resp_all_nitrate.data)
summary(mm_resp_2)

# it looks to me like temperature really drives the model

    # Question: is there a dose of nitrate where we see a statistically significant effect on respiration?
#Pairwise for N_species_dose
emm_resp_2_N_species_dose=emmeans(mm_resp_2, specs=pairwise ~ N_species_dose)
summary(emm_resp_2_N_species_dose)
 # contrast          estimate       SE  df t.ratio p.value
 # CNTRL_0 - N_1.5 -0.0004036 0.000225 287  -1.795  0.2777
 # CNTRL_0 - N_18   0.0003303 0.000244 304   1.352  0.5308
 # CNTRL_0 - N_5    0.0000634 0.000233 300   0.272  0.9930
 # N_1.5 - N_18     0.0007339 0.000243 296   3.026  0.0143 ***
 # N_1.5 - N_5      0.0004670 0.000232 291   2.016  0.1843
 # N_18 - N_5      -0.0002669 0.000246 290  -1.086  0.6981

# There is a difference between N1.5 and N18 but there is no difference between N0 and N18

    # Question: do corals that experienced heat stress have statistically significant different respiration?
#pairwise for temp
emm_resp_2_temp=emmeans(mm_resp_2, specs=pairwise ~ temp)
summary(emm_resp_2_temp)
 # contrast        estimate       SE  df t.ratio p.value
 # temp20 - temp30 -0.00057 0.000175 324  -3.250  0.0013
    # Answer: Yes! Corals at 30C respired less than those at 20C.
mean(all_20C$resp_rate, na.rm=TRUE)
#-0.004504099 #respired more than 30C
mean(all_30C$resp_rate, na.rm=TRUE)
#-0.004090608

# Question: do sym versus apo have statistically significant different respiration? # NOT IN OUR MODEL!

# Question: do E. coli versus no e coli have statistically significant different respiration?
#pairwise for e coli
emm_resp_2_e_coli=emmeans(mm_resp_2, specs=pairwise ~ e_coli_plate)
summary(emm_resp_2_e_coli)
 # contrast                      estimate       SE  df t.ratio p.value
 # e_coli_plate0 - e_coli_plate1 0.000373 0.000194 318   1.925  0.0551
  #Answer: E. coli plates respired marginally more than plates without e coli.
mean(e_coli$resp_rate, na.rm=TRUE)
# -0.004447118 #respired more than no_e_coli
mean(no_e_coli$resp_rate, na.rm=TRUE)
# -0.004125291


#Question: what is the relationship between N dose and E. coli?
emm_resp_2_N_dose_e_coli=emmeans(mm_resp_2, specs=pairwise ~ N_species_dose*e_coli_plate)
summary(emm_resp_2_N_dose_e_coli)
#  contrast                                         estimate       SE  df t.ratio p.value
#  CNTRL_0 e_coli_plate0 - N_1.5 e_coli_plate0   -0.00102935 0.000324 303  -3.178  0.0346
#  N_1.5 e_coli_plate0 - N_18 e_coli_plate1       0.00147009 0.000351 321   4.190  0.0009
#  N_1.5 e_coli_plate0 - N_5 e_coli_plate1        0.00110336 0.000343 318   3.215  0.0308


#Question: what is the relationship between E. coli and temperature?
emm_resp_2_temp_e_coli=emmeans(mm_resp_2, specs=pairwise ~ temp*e_coli_plate)
summary(emm_resp_2_temp_e_coli)
 # contrast                                     estimate       SE  df t.ratio p.value
 # temp20 e_coli_plate0 - temp30 e_coli_plate0 -0.000570 0.000175 324  -3.250  0.0069
 # temp30 e_coli_plate0 - temp20 e_coli_plate1  0.000944 0.000265 333   3.565  0.0023
 # temp20 e_coli_plate1 - temp30 e_coli_plate1 -0.000570 0.000175 324  -3.250  0.0069
# Corals treated without E. coli respired more at 20C than 30C
# Corals treated WITH E. coli respired more at 20C than 30C
# Corals at 20C WITH E. coli respired more than corals at 30C without E. coli


# Question: what is the relationship between N species dose and temperature?
emm_resp_2_N_dose_temp=emmeans(mm_resp_2, specs=pairwise ~ N_species_dose*temp)
summary(emm_resp_2_N_dose_temp)
 # contrast                          estimate       SE  df t.ratio p.value
 # CNTRL_0 temp20 - CNTRL_0 temp30 -0.0005703 0.000175 324  -3.250  0.0276  #Control 20C corals respired more than control 30C
 # CNTRL_0 temp20 - N_1.5 temp30   -0.0009738 0.000290 309  -3.357  0.0198  #Dont think we care
 # N_1.5 temp20 - N_18 temp20       0.0007339 0.000243 296   3.026  0.0540  # N 18 respired more than N 1.5 at 20C
 # N_1.5 temp20 - N_1.5 temp30     -0.0005703 0.000175 324  -3.250  0.0276  # N 1.5 20C corals respired more than at 30C
 # N_18 temp20 - CNTRL_0 temp30    -0.0009006 0.000302 301  -2.985  0.0605  # 
 # N_18 temp20 - N_1.5 temp30      -0.0013042 0.000305 301  -4.277  0.0007
 # N_18 temp20 - N_18 temp30       -0.0005703 0.000175 324  -3.250  0.0276  # at 30 you respire less under N 18
 # N_5 temp20 - N_1.5 temp30       -0.0010373 0.000296 302  -3.508  0.0120
 # N_5 temp20 - N_5 temp30         -0.0005703 0.000175 324  -3.250  0.0276
 # N_1.5 temp30 - N_18 temp30       0.0007339 0.000243 296   3.026  0.0540  # N 18 respired more than N 1.5 at 30C


```

```{r Model interaction plots}
# Reminder: this is our model
mm_resp_2 <- lmer(resp_rate ~ N_species_dose + temp + e_coli_plate + (1 | col_num) + N_species_dose*e_coli_plate, data=resp_all_nitrate.data)
summary(mm_resp_2)


#Model Interaction plot - NITRATE
# WHY WONT YOU WORK? BOBBBBBBBBB!
int_nitrate<-lmer(resp_rate~N_species_dose*temp*e_coli_plate+(1|col_num), data=resp_all_nitrate.data)
summary(int_nitrate)
int_pred_nitrate <- ggemmeans(int_nitrate, terms=c("N_species_dose", "temp","e_coli_plate")) # I cannot do more than 4 interactions 
pred_nitrate <- ggplot(int_pred_nitrate, aes(facet,predicted, colour = group)) +
  geom_point(aes(shape = x)) +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.3) +
  labs(x = "temp", y = "Rate O2 Consumption (umol*min-1*g-1)",
       color = "temp") +
  facet_grid(~panel) +
  ggtitle("test") +
  theme_classic() +
  theme(axis.title.x = element_text(color="black", size=12),
axis.title.y = element_text(color="black", size=12))+
  theme(axis.text.x = element_text(size=12),
          axis.text.y = element_text(size=12)) +
  scale_color_manual(values=c("black", "goldenrod"))
pred_nitrate
pred_nitrate <- ggplot(int_pred_nitrate, aes(facet,predicted, colour = group))

```

```{r Graphs - Summarizing by each variable}
#Make N species dose a factor and give it levels so it will display in this order
resp_all_nitrate.data$N_species_dose <- factor(resp_all_nitrate.data$N_species_dose, levels=c("CNTRL_0", "N_1.5", "N_5","N_18"))

#Make everything else a character so they graph nicely 
resp_all_nitrate.data$treat_ID_full<-as.character(resp_all_nitrate.data$treat_ID_full)
resp_all_nitrate.data$e_coli_plate<-as.character(resp_all_nitrate.data$e_coli_plate)
resp_all_nitrate.data$temp <- as.character(resp_all_nitrate.data$temp)

# Summarize by N_species_dose so we can visualize
sum_N_species_dose_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("N_species_dose"))
# Visualize
gg_N_species_dose_nitrate<-ggplot(data = sum_N_species_dose_nitrate,
       aes(x = N_species_dose,
           y = resp_rate, col=N_species_dose)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate - N Species Dose summary") +
   theme(legend.position="none")+
    labs(x = "\n", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    scale_x_discrete("Nitrate dose", labels=c(CNTRL_0="Control", N_1.5="1.5uM", N_5="5uM", N_18="18uM"))+
    scale_color_manual(labels=labels, values=c("blue", "#9DCE9D","#359C35","darkgreen"))
gg_N_species_dose_nitrate

# Summarize by temperature so we can visualize
sum_temp_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("temp"))
# Visualize
gg_temp_nitrate<-ggplot(data = sum_temp_nitrate,
       aes(x = temp,
           y = resp_rate, col=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate- Temperature summary") +
  theme(legend.position="none")+
    labs(x = "Temperature", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    scale_x_discrete("Temperature", labels=c("20"="Control 20C", "30"="Elevated 30C")) +
    scale_color_manual(labels=labels, values=c("blue", "red"))
gg_temp_nitrate

# Summarize by E. coli so we can visualize
sum_e_coli_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("e_coli_plate"))
# Visualize
gg_e_coli_nitrate<-ggplot(data = sum_e_coli_nitrate,
       aes(x = e_coli_plate,
           y = resp_rate, col=e_coli_plate)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate- E. coli summary") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # scale_x_discrete(labels=c("20C","30C"))+
    theme(legend.position="none")+
    labs(x = "E. coli presence", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
        scale_x_discrete("E. coli presence", labels=c("0"="No E. coli", "1"="E. coli")) +
    scale_color_manual(labels=labels, values=c("gray", "goldenrod"))
gg_e_coli_nitrate

# Summarize by sym state so we can visualize
sum_sym_state_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("sym_state"))
# Visualize
gg_sym_state_nitrate<-ggplot(data = sum_sym_state_nitrate,
       aes(x = sym_state,
           y = resp_rate, col=sym_state)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate- Sym state summary") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "Symbiotic state", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
        theme(legend.position="none")+
        scale_x_discrete("Symbiotic State", labels=c("A"="Apo", "S"="Symbiotic")) +
        scale_color_manual(labels=labels, values=c("gray", "darkgoldenrod"))
gg_sym_state_nitrate
summary(aov(resp_rate ~ sym_state, data=resp_all_nitrate.data))
# UGH THEY ARE DIFFERENT! But it doesnt  come up in the overall model
#Let's jitter to check this out
gg_sym_state_nitrate_jitter<-ggplot(data = resp_all_nitrate.data,
       aes(x = sym_state,
           y = resp_rate, col=sym_state)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) + #this overlays the raw data  
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate- Sym state summary") +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "Symbiotic state", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
        theme(legend.position="none")+
        scale_x_discrete("Symbiotic State", labels=c("A"="Apo", "S"="Symbiotic")) +
        scale_color_manual(labels=labels, values=c("gray", "darkgoldenrod"))
gg_sym_state_nitrate_jitter
summary(lm(resp_rate ~ sym_state, data=resp_all_nitrate.data))

# Summarize by food so we can visualize
sum_food_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("food"))
# Visualize
gg_food_nitrate<-ggplot(data = sum_food_nitrate,
       aes(x = food,
           y = resp_rate, col=food)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate- Food summary") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "Symbiotic state", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    theme(legend.position="none")+
   scale_x_discrete("Food presence", labels=c("F"="Fed", "S"="Starved")) +
   scale_color_manual(labels=labels, values=c("brown", "black"))
gg_food_nitrate
summary(lm(resp_rate ~ sym_state, data=resp_all_nitrate.data))


# Summarize by food and sym state so we can visualize
sum_food_sym_state_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("sym_state","food"))
legend_title<-"Fucking test"
# Visualize
gg_food_sym_state_nitrate<-ggplot(data = sum_food_sym_state_nitrate,
       aes(x = sym_state,
           y = resp_rate, col=food)) + #use fill here or the legends will be really hard to work with
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    ggtitle ("Nitrate- Sym state and food summary") +
   #scale_fill_manual(name="Feeding Regime", labels=c('Fed', 'Starved'))+
 # scale_fill_manual(values=c("brown", "darkgray"))+
    labs(x = "Symbiotic state", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
      scale_x_discrete(name="Symboitic state", labels=c("A"="Aposymbiotic", "S"="Symbiotic")) +
  # scale_fill_manual(values=c("brown", "darkgray"))
 scale_color_manual(values=c("brown", "darkgray"))
gg_food_sym_state_nitrate #seems obvious that food doesnt matter

# Summarize by temp and N species dose so we can visualize
sum_N_species_dose_temp_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("temp","N_species_dose"))
# Visualize
gg_N_species_dose_temp_nitrate<-ggplot(data = sum_N_species_dose_temp_nitrate,
       aes(x = N_species_dose,
           y = resp_rate, colour=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate - N species dose and temperature summary") +
     
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "Nitrate dose", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
  scale_x_discrete("Symboitic state", labels=c("A"="Aposymbiotic", "S"="Symbiotic")) +
    scale_color_manual(labels=labels, values=c("brown", "darkgray"))
gg_N_species_dose_temp_nitrate 

# Summarize by e_coli and N species dose so we can visualize
sum_N_species_dose_e_coli_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("e_coli_plate","N_species_dose"))
# Visualize
gg_N_species_dose_e_coli_nitrate<-ggplot(data = sum_N_species_dose_e_coli_nitrate,
       aes(x = N_species_dose,
           y = resp_rate, colour=e_coli_plate)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate- N species dose and e coli summary") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "Nitrate dose", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
   scale_x_discrete("Nitrate dose", labels=c(CNTRL_0="Control", N_1.5="1.5uM", N_5="5uM", N_18="18uM"))+
     scale_color_manual(labels=labels, values=c("gray", "darkgoldenrod"))
gg_N_species_dose_e_coli_nitrate

# Summarize by e_coli and temp so we can visualize
sum_temp_e_coli_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("e_coli_plate","temp"))
# Visualize
gg_temp_e_coli_nitrate<-ggplot(data = sum_temp_e_coli_nitrate,
       aes(x = e_coli_plate,
           y = resp_rate, colour=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate- temperature and e coli summary") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
   # scale_x_discrete(labels=c("20C","30C"))+
    labs(x = "E. coli", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
     scale_x_discrete("E. coli presence", labels=c("0"="No E. coli", "1"="E coli"))+
     scale_color_manual(labels=labels, values=c("blue", "red"))
gg_temp_e_coli_nitrate

# Summarize by temp and N species dose so we can visualize
sum_N_species_dose_temp_nitrate <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("temp","N_species_dose"))
# Visualize
gg_N_species_dose_temp_nitrate<-ggplot(data = sum_N_species_dose_temp_nitrate,
       aes(x = N_species_dose,
           y = resp_rate, col=temp)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("Nitrate - N species dose and temperature summary") +
    labs(x = "Nitrate dose", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    scale_x_discrete("Nitrate dose", labels=c(CNTRL_0="Control", N_1.5="1.5uM", N_5="5uM", N_18="18uM"))+
    scale_color_manual("Temperature",labels=c("20C","30C"), values=c("blue", "red"))
gg_N_species_dose_temp_nitrate

# Summarize by N_species_dose and sym state so we can visualize
sum_N_species_dose_nitrate_sym_state <- summarySE(resp_all_nitrate.data, measurevar = "resp_rate", groupvars = c("N_species_dose", "sym_state"))
# Visualize
sum_N_species_dose_nitrate_sym_state <-ggplot(data = sum_N_species_dose_nitrate_sym_state,
       aes(x = N_species_dose,
           y = resp_rate, col=sym_state)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    ggtitle ("Nitrate - N Species Dose and sym state summary") +
   #theme(legend.position="none")+
    labs(x = "\n", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    scale_x_discrete("Nitrate dose", labels=c(CNTRL_0="Control", N_1.5="1.5uM", N_5="5uM", N_18="18uM"))+
    scale_color_manual(labels=c("Apo","Sym"), values=c("gray", "brown"))
sum_N_species_dose_nitrate_sym_state
```


```{r Graphs - Plotting model estimates}
#Plot model estimate for N_species_dose # I am not sure how interesting this is, but here is the code if we want it
l=plot_model(mm_resp_2, 'pred', ci.lvl = 0.95, terms="N_species_dose")
l +
  theme_classic() +
xlab("N species dose")+
  ylab("Rate O2 Consumption (umol*min-1*g-1)")+
  ggtitle("")+
  theme(axis.title.x = element_text(color="black", size=14, face="bold"),
axis.title.y = element_text(color="black", size=14, face="bold"))+
  theme(axis.text.x = element_text(size=14),
          axis.text.y = element_text(size=14))
# plot model estimate for temp


```


```{r Looking at Nitrate 18uM}
# We found in the above analyses that there was a statistically significant difference between Control and 18uM under E. coli. Let's zoom out and look at 18uM and see what might be driving that model 

#QUESTION: For corals at 18uM nitrate, is there a significant difference if you are 1) fed vs starved? 2) E. coli vs. no E. coli? 3) sym vs apo?   4) 20 vs. 30C? 

summary(aov(e_coli_18uM$resp_rate ~ e_coli_18uM$temp))


#Maybe let's graph 18uM and see what comes out
lm_all_18uM<- lm(resp_rate~e_coli_plate + temp + food + sym_state, data=all_18uM)
summary(lm_all_18uM)
# Summarize by E. coli -- it looks like there is a difference here, but it just doesn't come out as significant
all_18uM_sum_e_coli <- summarySE(all_18uM, measurevar = "resp_rate", groupvars = c("e_coli_plate"))
# Summarize by food
all_18uM_sum_food <- summarySE(all_18uM, measurevar = "resp_rate", groupvars = c("food"))
# Summarize by sym-state
all_18uM_sum_sym_state <- summarySE(all_18uM, measurevar = "resp_rate", groupvars = c("sym_state"))
# Summarize by temp
all_18uM_sum_temp <- summarySE(all_18uM, measurevar = "resp_rate", groupvars = c("temp"))
# Visualize
ggplot(data = all_18uM_sum_e_coli,
       aes(x = e_coli_plate,
           y = resp_rate)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("N 18uM - e. coli vs. no e. coli") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
    labs(x = "\n", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    theme_classic()

# What about 18uM treated with E. coli
e_coli_18uM<-subset(resp_all_nitrate.data, resp_all_nitrate.data$N_species_dose=="N_18" & resp_all_nitrate.data$e_coli_plate==1)

# Summarize by food
e_coli_18uM_sum_food <- summarySE(e_coli_18uM, measurevar = "resp_rate", groupvars = c("food"))
# Summarize by sym-state
e_coli_18uM_sum_sym_state <- summarySE(e_coli_18uM, measurevar = "resp_rate", groupvars = c("sym_state"))
# Summarize by temp
e_coli_18uM_sum_temp <- summarySE(e_coli_18uM, measurevar = "resp_rate", groupvars = c("temp"))
# Visualize
ggplot(data = e_coli_18uM_sum_food,
       aes(x = food,
           y = resp_rate)) +
    geom_point() +
    geom_errorbar(aes(ymin=resp_rate-se, ymax=resp_rate+se), width=0.1, size = 1) +
    #scale_color_manual(values = c("black", "darkgreen")) +
    ggtitle ("N 18uM with E. Coli - fed vs. starved") +
    theme(legend.position = "right",
          legend.title = element_text(size=12),
          axis.title = element_text(size = 12),
          legend.background = element_blank(),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12)) +
    labs(x = "\n", 
         y = expression(paste("Rate O2 Consumption (umol*min"^"-1"~"*g"^"-1"~")")), 
         caption = "data represent mean +/- SEM" ) +
    theme_classic()

```




```{r playing around with Sarahs code to see if there is an effect of E coli at every treatment}

#Generate a linear model and then use the log function on it, why are we doing this bestie?
mm_resp_TREAT_ID <- lmer(resp_rate ~ treat_ID_collapsed_controls + (1|exp_num) + (1|col_num), data= resp_all_nitrate.data)
mm_resp_TREAT_ID_log<- Log(mm_resp_TREAT_ID)~e_coli_plate + (1|exp_num) + (1|col_num)
summary(mm_resp_TREAT_ID_log)

# Question: Is there a significant change of resp rate at each treatment ID under E coli?
# create grouping factor to run all linear models for each treatment at once
by_treat_all <- group_by(resp_all_nitrate.data, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_all <- 
  do(by_treat_all, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
print(response.lm_all)

# TEMP
#create grouping factor to run all linear models for each treatment at once
by_treat_20C<- group_by(all_20C, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_20C <- 
  do(by_treat_20C, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
response.lm_20C

# create grouping factor to run all linear models for each treatment at once
by_treat_30C<- group_by(all_30C, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_30C <- 
  do(by_treat_30C, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
response.lm_30C

# SYM STATE
#create grouping factor to run all linear models for each treatment at once
by_treat_sym<- group_by(all_sym, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_sym <- 
  do(by_treat_sym, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
response.lm_sym

# create grouping factor to run all linear models for each treatment at once
by_treat_apo<- group_by(all_apo, treat_ID_collapsed_controls)

# Create a df with the parameter coefficients of the linear models  
response.lm_apo <- 
  do(by_treat_apo, 
   tidy(                     
     lm(resp_rate~e_coli_plate, data= .)))
response.lm_apo

```



#Graphs and visualizations

```{r Graphs NITRATE}
#1
gg_resp_all_ecoli<-
  ggplot(e_coli, aes(x=treat_ID_full, y=resp_rate, color=col_num)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by treat ID - E. coli")
gg_resp_all_ecoli

#2
gg_food_sym_state_ecoli<-
  ggplot(e_coli, aes(x=food_sym_state, y=resp_rate, color=col_num)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by Food and Symbiotic State (Food_Symstate) - E. coli")
gg_food_sym_state_ecoli

#3
gg_resp_all_no_ecoli<-
  ggplot(no_e_coli, aes(x=treat_ID_collapsed_controls, y=resp_rate, color=col_num)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by treat ID - No E. coli")
gg_resp_all_no_ecoli

#4
gg_food_sym_state_no_ecoli<-
  ggplot(no_e_coli, aes(x=food_sym_state, y=resp_rate, color=col_num)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by Food and Symbiotic State (Food_Symstate) - No E. coli")
gg_food_sym_state_no_ecoli


#5
gg_N_species_dose_ecoli<-
  ggplot(e_coli, aes(x=N_species_dose, y=resp_rate, color=col_num)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_label(position="jitter")+
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual()+
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by N_species_dose - E. coli")
gg_N_species_dose_ecoli
?geom_label

#6
gg_N_species_dose_no_ecoli<-
  ggplot(no_e_coli, aes(x=N_species_dose, y=resp_rate, color=col_num)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by N_species_dose - No E. coli")
gg_N_species_dose_no_ecoli


#7
e_coli$temp<-as.factor(e_coli$temp)
gg_temp_ecoli<-
  ggplot(e_coli, aes(x=temp, y=resp_rate)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Temperature")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by Temp - E. coli")
gg_temp_ecoli

#8
no_e_coli$temp<-as.factor(no_e_coli$temp)
gg_temp_no_ecoli<-
  ggplot(no_e_coli, aes(x=temp, y=resp_rate, color=col_num)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by Temp - No E. coli")
gg_temp_no_ecoli

#9
no_e_coli$sym_state<-as.factor(no_e_coli$sym_state)
gg_sym_state_no_ecoli<-
  ggplot(no_e_coli, aes(x=sym_state, y=resp_rate)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by Sym state - No E. coli")
gg_sym_state_no_ecoli

#10
e_coli$sym_state<-as.factor(e_coli$sym_state)
gg_sym_state_ecoli<-
  ggplot(e_coli, aes(x=sym_state, y=resp_rate)) +
  geom_boxplot(width=0.8) +
  geom_jitter(width=0.15, alpha=0.9) +
 # geom_line(aes(group=e_coli_plate), col="darkgray")+
  ylab("Respirometry rate")+
  xlab("Treat ID")+
  theme(legend.position="none", plot.title = element_text(size = 9)) +
  #scale_color_manual(name = "Day of experiment",
                     #labels = c("Day 1","Day 11"),
                   # values = c("royalblue","darkorchid1"))+
 # scale_x_discrete(labels=c("Day 1","Day 11")) +
    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+ #this makes the x axis labels up and down instead of side to side to prevent overlapping
 annotate("text", x = Inf, y = Inf, label = paste("  "), vjust = 1, hjust = 1, size=3)+
  ggtitle("Resp rate by Sym state - No E. coli")
gg_sym_state_ecoli

```


# OVERALL ANOVA
```{r MANOVA or ANOVA}

#What is a MANOVA?
  # A MANOVA is used when there are multiple dependent variables as well as independent variables in the study. MANOVA combines the multiple dependent variables in a linear manner to produce a combination which best separates the independent variable groups. Can only be used when the dependent variable is continuous
      # NOTE: the non parametric version of this is a PERMANOVA

#What is the difference between a MANOVA and a linear model?
  #  MANOVA will give you a very different answer than multiple regression analyses. MANOVA will look for a linear combination of the independent variables that minimizes ordinary least squares for the set of dependent variables. So, if the variables are not related in some way, it doesn't make much sense to combine them. To answer your question about why do a MANOVA, we can simply state that running multiple regressions (or ANOVAs) will inflate your type I error rate. Think about why you run an ANOVA instead of many t-tests.

# I ACTUALLY THINK WE WANT A UNIVARIATE ANALYSIS BECAUSE WE ONLY HAVE ONE OUTPUT -- RESPIRATION RATE

#We should do a seperate ANOVA for e coli and no e coli
aov_resp_e_coli <- aov(resp_rate ~ N_species * N_dose * temp * food * sym_state, data=e_coli)
summary(aov_resp_e_coli)

```


